#include "LCD_lib.h"
#include "niusb6501.h"
#include "game_timer.h"
#include <unistd.h>

#define DELAY 5000

void init_timer(gameTimer_t *timer){
  timer->minute = '3';
  timer->tens_sec = '0';
  timer->ones_sec = '0';
  timer->timer = TIME_LIMIT;
}

void tick_timer(gameTimer_t *timer){
  static int cnt = DELAY;
  cnt++;

  if(cnt > DELAY){
    disp_timer(timer);
    timer->timer--;
    if(timer->tens_sec == '0' && timer->ones_sec == '0'){
      timer->minute--;
      timer->tens_sec = '5';
      timer->ones_sec = '9';
    }else if(timer->ones_sec == '0'){
      timer->tens_sec--;
      timer->ones_sec = '9';
    }else{
      timer->ones_sec--;
    }
    cnt = 0;
  }
  
  usleep(1);
}

void disp_timer(const gameTimer_t *timer){
  clear_display();
  cursor_at_home();
      
  disp_char(timer->minute);
  disp_char(':');
  disp_char(timer->tens_sec);
  disp_char(timer->ones_sec);

}
